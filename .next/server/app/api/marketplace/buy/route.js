"use strict";(()=>{var e={};e.id=514,e.ids=[514],e.modules={3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},8086:e=>{e.exports=require("module")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{e.exports=require("punycode")},12412:e=>{e.exports=require("assert")},27910:e=>{e.exports=require("stream")},28354:e=>{e.exports=require("util")},29021:e=>{e.exports=require("fs")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{e.exports=require("path")},34631:e=>{e.exports=require("tls")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},48161:e=>{e.exports=require("node:os")},53053:e=>{e.exports=require("node:diagnostics_channel")},55511:e=>{e.exports=require("crypto")},55591:e=>{e.exports=require("https")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73566:e=>{e.exports=require("worker_threads")},74075:e=>{e.exports=require("zlib")},76760:e=>{e.exports=require("node:path")},77598:e=>{e.exports=require("node:crypto")},78474:e=>{e.exports=require("node:events")},79428:e=>{e.exports=require("buffer")},79551:e=>{e.exports=require("url")},81630:e=>{e.exports=require("http")},91645:e=>{e.exports=require("net")},94735:e=>{e.exports=require("events")},95611:(e,r,t)=>{t.r(r),t.d(r,{patchFetch:()=>y,routeModule:()=>c,serverHooks:()=>h,workAsyncStorage:()=>q,workUnitAsyncStorage:()=>f});var s={};t.r(s),t.d(s,{POST:()=>x});var o=t(45002),a=t(89587),n=t(1202),i=t(24715),p=t(76036),u=t(30626),d=t(50138),l=t(95489);async function x(e){try{let r;let{nft_id:t,buyer:s,seller:o,use_flow_transaction:a=!1}=await e.json();if(!t)return i.NextResponse.json({error:"nft_id is required"},{status:400});if(!s)return i.NextResponse.json({error:"buyer address is required"},{status:400});if(!/^0x[a-fA-F0-9]{16}$/.test(s))return i.NextResponse.json({error:"Invalid buyer Flow address format"},{status:400});if(a&&o){console.log("Using Flow transaction for purchase");let e=await l.$.purchaseNFT(t,o);if("failed"===e.status)throw Error(e.error||"Flow transaction failed");r={transaction_hash:e.transactionId,status:"completed",processed_at:new Date().toISOString(),method:"flow_transaction"}}else console.log("Using Dapper Core API for purchase"),r=await p.Y.buyNFT({nft_id:t,buyer:s});return d.v.invalidateCache(),i.NextResponse.json(r)}catch(e){if(console.error("Marketplace buy error:",e),e instanceof u.z)return i.NextResponse.json({error:e.message,type:e.type,details:e.details},{status:e.statusCode||500});return i.NextResponse.json({error:e instanceof Error?e.message:"Internal server error"},{status:500})}}let c=new o.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/marketplace/buy/route",pathname:"/api/marketplace/buy",filename:"route",bundlePath:"app/api/marketplace/buy/route"},resolvedPagePath:"/home/altcoin-daddy/Downloads/ownly/app/api/marketplace/buy/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:q,workUnitAsyncStorage:f,serverHooks:h}=c;function y(){return(0,n.patchFetch)({workAsyncStorage:q,workUnitAsyncStorage:f})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[555,912,700,207,540,798],()=>t(95611));module.exports=s})();