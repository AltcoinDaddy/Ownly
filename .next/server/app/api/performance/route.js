(()=>{var e={};e.id=588,e.ids=[588],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},8086:e=>{"use strict";e.exports=require("module")},10596:()=>{},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},12412:e=>{"use strict";e.exports=require("assert")},17546:()=>{},27599:(e,t,r)=>{"use strict";r.d(t,{$:()=>a,cn:()=>i});var s=r(46968),n=r(69333);function i(...e){return(0,n.QP)((0,s.$)(e))}function a(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},34631:e=>{"use strict";e.exports=require("tls")},34754:(e,t,r)=>{"use strict";r.d(t,{yx:()=>c});var s=r(26207),n=r(53829),i=r(69535);let a={COLLECTIBLE_MINTED:"CollectibleMinted",COLLECTIBLE_TRANSFERRED:"CollectibleTransferred",SALE_COMPLETED:"SaleCompleted",LISTING_CREATED:"ListingCreated"};class o{addProcessor(e,t){this.processors.set(e,t)}removeProcessor(e){this.processors.delete(e)}async enqueue(e){let t=this.queue.length;this.queue.push(e),await i.Y5.recordEventMetric({eventType:"queue_enqueue",processingTime:0,queueSize:t+1,eventSource:"internal",tags:{event_type:e.type,operation:"enqueue"}}),this.processing||await this.processQueue()}async processQueue(){for(this.processing=!0;this.queue.length>0;){let e=this.queue.shift();if(e){let t=this.processors.get(e.type);if(t){let r=performance.now();try{await t(e);let s=performance.now()-r;await i.Y5.recordEventMetric({eventType:e.type,processingTime:s,queueSize:this.queue.length,eventSource:this.getEventSource(e),blockHeight:e.blockHeight,transactionId:e.transactionId,tags:{success:"true",processor:e.type}})}catch(s){let t=performance.now()-r;await i.Y5.recordEventMetric({eventType:e.type,processingTime:t,queueSize:this.queue.length,eventSource:this.getEventSource(e),blockHeight:e.blockHeight,transactionId:e.transactionId,tags:{success:"false",processor:e.type,error:s instanceof Error?s.message:"unknown"}}),console.error(`[EventQueue] Error processing event ${e.type}:`,s)}}}}this.processing=!1}getEventSource(e){return e.transactionId?"flow":e.type.includes("Dapper")?"dapper":"internal"}getQueueSize(){return this.queue.length}constructor(){this.queue=[],this.processing=!1,this.processors=new Map}}let c=new o,l=null;async function u(){if(!l){let{eventHandlerRegistry:e}=await r.e(613).then(r.bind(r,9613));l=e}return l}async function p(e){try{let t=await u();await t.processEvent(e)}catch(e){console.error("[FlowEvents] Error processing event through handlers:",e)}}class h{subscribeToMintEvents(e){let t=(0,n.RZ)("DapperCollectibles"),r=`A.${t.replace("0x","")}.DapperCollectibles.CollectibleMinted`;console.log("[FlowEventListener] Subscribing to mint events:",r);let i=s.events(r).subscribe({next:t=>{console.log("[FlowEventListener] Mint event received:",t);let r={type:a.COLLECTIBLE_MINTED,transactionId:t.transactionId,blockHeight:t.blockHeight,eventIndex:t.eventIndex,data:this.parseMintEventData(t.data),timestamp:new Date};c.enqueue(r),p(r),e(r)},error:t=>{console.error("[FlowEventListener] Mint event subscription error:",t),this.handleSubscriptionError("mint",()=>this.subscribeToMintEvents(e))}});return this.subscriptions.set("mint",i),this.reconnectAttempts=0,i}subscribeToTransferEvents(e){let t=(0,n.RZ)("DapperCollectibles"),r=`A.${t.replace("0x","")}.DapperCollectibles.CollectibleTransferred`;console.log("[FlowEventListener] Subscribing to transfer events:",r);let i=s.events(r).subscribe({next:t=>{console.log("[FlowEventListener] Transfer event received:",t);let r={type:a.COLLECTIBLE_TRANSFERRED,transactionId:t.transactionId,blockHeight:t.blockHeight,eventIndex:t.eventIndex,data:this.parseTransferEventData(t.data),timestamp:new Date};c.enqueue(r),p(r),e(r)},error:t=>{console.error("[FlowEventListener] Transfer event subscription error:",t),this.handleSubscriptionError("transfer",()=>this.subscribeToTransferEvents(e))}});return this.subscriptions.set("transfer",i),this.reconnectAttempts=0,i}parseMintEventData(e){try{return{nftId:e.id?.value||e.id,recipient:e.to?.value||e.to,collectionId:e.collectionId?.value||e.collectionId,metadataUrl:e.metadataUrl?.value||e.metadataUrl,creator:e.creator?.value||e.creator,rawData:e}}catch(t){return console.error("[FlowEventListener] Error parsing mint event data:",t),{rawData:e}}}parseTransferEventData(e){try{return{nftId:e.id?.value||e.id,from:e.from?.value||e.from,to:e.to?.value||e.to,collectionId:e.collectionId?.value||e.collectionId,rawData:e}}catch(t){return console.error("[FlowEventListener] Error parsing transfer event data:",t),{rawData:e}}}handleSubscriptionError(e,t){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.error(`[FlowEventListener] Max reconnection attempts reached for ${e} events`);return}this.reconnectAttempts++;let r=this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1);console.log(`[FlowEventListener] Attempting to reconnect ${e} events in ${r}ms (attempt ${this.reconnectAttempts})`),setTimeout(()=>{try{t()}catch(t){console.error(`[FlowEventListener] Reconnection failed for ${e}:`,t)}},r)}unsubscribeAll(){console.log("[FlowEventListener] Unsubscribing from all events"),this.subscriptions.forEach((e,t)=>{try{e(),console.log(`[FlowEventListener] Unsubscribed from ${t} events`)}catch(e){console.error(`[FlowEventListener] Error unsubscribing from ${t} events:`,e)}}),this.subscriptions.clear(),this.reconnectAttempts=0}getActiveSubscriptions(){return Array.from(this.subscriptions.keys())}constructor(){this.subscriptions=new Map,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=1e3}}new h;function g(e,t){try{if("sale"===t)return{nftId:e.nftId?.value||e.nftId,seller:e.seller?.value||e.seller,buyer:e.buyer?.value||e.buyer,price:e.price?.value||e.price,currency:e.currency?.value||e.currency||"FLOW",rawData:e};return{nftId:e.nftId?.value||e.nftId,seller:e.seller?.value||e.seller,price:e.price?.value||e.price,currency:e.currency?.value||e.currency||"FLOW",listingId:e.listingId?.value||e.listingId,rawData:e}}catch(r){return console.error(`[FlowEventListener] Error parsing ${t} event data:`,r),{rawData:e}}}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},45590:()=>{},48161:e=>{"use strict";e.exports=require("node:os")},52367:()=>{},53053:e=>{"use strict";e.exports=require("node:diagnostics_channel")},53829:(e,t,r)=>{"use strict";r.d(t,{AS:()=>c,NP:()=>o,RZ:()=>a,i7:()=>l});var s=r(26207);let n="testnet";s.config().put("app.detail.title","Ownly").put("app.detail.icon","https://ownly.app/icon.png").put("flow.network",n).put("accessNode.api","https://rest-testnet.onflow.org").put("discovery.wallet","https://fcl-discovery.onflow.org/testnet/authn").put("discovery.wallet.method","IFRAME/RPC");let i={testnet:{NonFungibleToken:"0x631e88ae7f1d7c20",MetadataViews:"0x631e88ae7f1d7c20",DapperCollectibles:"0x82ec283f88a62e65",DapperMarket:"0x94b06cfca1d8a476",NFTStorefront:"0x94b06cfca1d8a476",FungibleToken:"0x9a0766d93b6608b7",FlowToken:"0x7e60df042a9c0868"},mainnet:{NonFungibleToken:"0x1d7e57aa55817448",MetadataViews:"0x1d7e57aa55817448",DapperCollectibles:"0x82ec283f88a62e65",DapperMarket:"0x4eb8a10cb9f87357",NFTStorefront:"0x4eb8a10cb9f87357",FungibleToken:"0xf233dcee88fe0abe",FlowToken:"0x1654653399040a61"}},a=e=>i[n][e],o="ownly_collectibles",c="https://nftstorage.link/ipfs/",l=process.env.NEXT_PUBLIC_NFT_STORAGE_KEY||""},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},64397:()=>{},69535:(e,t,r)=>{"use strict";r.d(t,{Y5:()=>o});class s{constructor(e=1e4){this.metrics=[],this.maxEntries=e}async store(e){if(this.metrics.push(e),this.metrics.length>this.maxEntries){let e=this.metrics.length-this.maxEntries;this.metrics.splice(0,e)}}async query(e){let t=this.metrics;return e.category&&(t=t.filter(t=>t.category===e.category)),e.startTime&&(t=t.filter(t=>t.timestamp>=e.startTime)),e.endTime&&(t=t.filter(t=>t.timestamp<=e.endTime)),e.tags&&(t=t.filter(t=>!!t.tags&&Object.entries(e.tags).every(([e,r])=>t.tags[e]===r))),t.sort((e,t)=>t.timestamp.getTime()-e.timestamp.getTime()),e.limit&&(t=t.slice(0,e.limit)),t}async getAggregated(e,t,r){let s=this.metrics.filter(r=>r.category===e&&r.timestamp>=t.start&&r.timestamp<=t.end);if(0===s.length)return[];let n=new Map;s.forEach(e=>{let t="all";if(r)switch(r){case"endpoint":t=e.endpoint||"unknown";break;case"eventType":t=e.eventType||"unknown";break;case"operation":t=e.operation||"unknown";break;case"component":t=e.component||"unknown";break;case"hour":t=e.timestamp.toISOString().slice(0,13)+":00:00";break;case"day":t=e.timestamp.toISOString().slice(0,10);break;default:t="all"}n.has(t)||n.set(t,[]),n.get(t).push(e)});let i=Array.from(n.entries()).map(([e,t])=>{let r=t.map(e=>e.value).sort((e,t)=>e-t),s=r.length,n=r.reduce((e,t)=>e+t,0),i=r[0],a=r[r.length-1],o=Math.floor(.95*s),c=Math.floor(.99*s),l=r[Math.min(o,s-1)],u=r[Math.min(c,s-1)];return{group:e,count:s,average:Math.round(n/s*100)/100,min:i,max:a,p95:l,p99:u}});return i.sort((e,t)=>e.group.localeCompare(t.group)),i}async cleanup(e){let t=this.metrics.length;return this.metrics=this.metrics.filter(t=>t.timestamp>e),t-this.metrics.length}getStorageStats(){let e,t;let r=this.metrics.length,s=JSON.stringify(this.metrics).length;if(r>0){let r=this.metrics.map(e=>e.timestamp).sort();e=r[0],t=r[r.length-1]}return{totalMetrics:r,memoryUsage:s,oldestMetric:e,newestMetric:t}}clear(){this.metrics=[]}}var n=r(27599);let i={enabled:!0,sampleRate:1,retentionDays:7,thresholds:{api:{responseTime:{warning:1e3,critical:3e3},errorRate:{warning:5,critical:10}},events:{processingTime:{warning:500,critical:2e3},queueSize:{warning:100,critical:500}},blockchain:{queryTime:{warning:2e3,critical:5e3},transactionTime:{warning:1e4,critical:3e4}}},alerting:{enabled:!0},storage:{type:"memory",maxMemoryEntries:1e4}};class a{constructor(e){this.alerts=[],this.alertCallbacks=[],this.config={...i,...e},this.storage=this.createStorage()}createStorage(){return this.config.storage.type,new s(this.config.storage.maxMemoryEntries||1e4)}shouldCollect(){return!!this.config.enabled&&Math.random()<this.config.sampleRate}async recordAPIMetric(e){if(!this.shouldCollect())return;let t={id:(0,n.$)(),name:`api_${e.method.toLowerCase()}_${e.endpoint.replace(/[^a-zA-Z0-9]/g,"_")}`,value:e.responseTime,unit:"ms",timestamp:new Date,category:"api",endpoint:e.endpoint,method:e.method,statusCode:e.statusCode,responseTime:e.responseTime,requestSize:e.requestSize,responseSize:e.responseSize,userAgent:e.userAgent,ip:e.ip,tags:e.tags};await this.storage.store(t),await this.checkAPIThresholds(t)}async recordEventMetric(e){if(!this.shouldCollect())return;let t={id:(0,n.$)(),name:`event_${e.eventType.toLowerCase().replace(/[^a-zA-Z0-9]/g,"_")}`,value:e.processingTime,unit:"ms",timestamp:new Date,category:"event",eventType:e.eventType,processingTime:e.processingTime,queueSize:e.queueSize,eventSource:e.eventSource,blockHeight:e.blockHeight,transactionId:e.transactionId,tags:e.tags};await this.storage.store(t),await this.checkEventThresholds(t)}async recordBlockchainMetric(e){if(!this.shouldCollect())return;let t={id:(0,n.$)(),name:`blockchain_${e.operation}_${e.network}`,value:e.responseTime,unit:"ms",timestamp:new Date,category:"blockchain",operation:e.operation,network:e.network,contractAddress:e.contractAddress,gasUsed:e.gasUsed,blockHeight:e.blockHeight,tags:{...e.tags,success:e.success.toString()}};await this.storage.store(t),await this.checkBlockchainThresholds(t)}async recordUIMetric(e){if(!this.shouldCollect())return;let t={id:(0,n.$)(),name:`ui_${e.component.toLowerCase().replace(/[^a-zA-Z0-9]/g,"_")}`,value:e.renderTime,unit:"ms",timestamp:new Date,category:"ui",component:e.component,renderTime:e.renderTime,interactionType:e.interactionType,route:e.route,tags:e.tags};await this.storage.store(t)}async checkAPIThresholds(e){let t=this.config.thresholds.api;if(e.responseTime>t.responseTime.critical?await this.createAlert({type:"critical",category:"api",message:`API response time critical: ${e.endpoint} took ${e.responseTime}ms`,metric:e,threshold:t.responseTime.critical}):e.responseTime>t.responseTime.warning&&await this.createAlert({type:"warning",category:"api",message:`API response time warning: ${e.endpoint} took ${e.responseTime}ms`,metric:e,threshold:t.responseTime.warning}),e.statusCode>=400){let r=await this.storage.query({category:"api",startTime:new Date(Date.now()-3e5),tags:{endpoint:e.endpoint}}),s=r.filter(e=>e.statusCode>=400).length,n=r.length,i=n>0?s/n*100:0;i>t.errorRate.critical?await this.createAlert({type:"critical",category:"api",message:`API error rate critical: ${e.endpoint} has ${i.toFixed(1)}% error rate`,metric:e,threshold:t.errorRate.critical}):i>t.errorRate.warning&&await this.createAlert({type:"warning",category:"api",message:`API error rate warning: ${e.endpoint} has ${i.toFixed(1)}% error rate`,metric:e,threshold:t.errorRate.warning})}}async checkEventThresholds(e){let t=this.config.thresholds.events;e.processingTime>t.processingTime.critical?await this.createAlert({type:"critical",category:"event",message:`Event processing time critical: ${e.eventType} took ${e.processingTime}ms`,metric:e,threshold:t.processingTime.critical}):e.processingTime>t.processingTime.warning&&await this.createAlert({type:"warning",category:"event",message:`Event processing time warning: ${e.eventType} took ${e.processingTime}ms`,metric:e,threshold:t.processingTime.warning}),e.queueSize>t.queueSize.critical?await this.createAlert({type:"critical",category:"event",message:`Event queue size critical: ${e.queueSize} events in queue`,metric:e,threshold:t.queueSize.critical}):e.queueSize>t.queueSize.warning&&await this.createAlert({type:"warning",category:"event",message:`Event queue size warning: ${e.queueSize} events in queue`,metric:e,threshold:t.queueSize.warning})}async checkBlockchainThresholds(e){let t=this.config.thresholds.blockchain["transaction"===e.operation?"transactionTime":"queryTime"];e.value>t.critical?await this.createAlert({type:"critical",category:"blockchain",message:`Blockchain ${e.operation} time critical: ${e.value}ms on ${e.network}`,metric:e,threshold:t.critical}):e.value>t.warning&&await this.createAlert({type:"warning",category:"blockchain",message:`Blockchain ${e.operation} time warning: ${e.value}ms on ${e.network}`,metric:e,threshold:t.warning})}async createAlert(e){let t={id:(0,n.$)(),type:e.type,category:e.category,message:e.message,metric:e.metric,threshold:e.threshold,timestamp:new Date,resolved:!1};this.alerts.push(t),this.alertCallbacks.forEach(e=>{try{e(t)}catch(e){console.error("[PerformanceCollector] Error in alert callback:",e)}}),console.warn(`[PerformanceCollector] ${e.type.toUpperCase()} ALERT: ${e.message}`)}onAlert(e){return this.alertCallbacks.push(e),()=>{let t=this.alertCallbacks.indexOf(e);t>-1&&this.alertCallbacks.splice(t,1)}}async getMetrics(e){return this.storage.query(e)}async getAggregatedMetrics(e,t,r){return this.storage.getAggregated(e,t,r)}getActiveAlerts(){return this.alerts.filter(e=>!e.resolved)}resolveAlert(e){let t=this.alerts.find(t=>t.id===e);t&&(t.resolved=!0,t.resolvedAt=new Date)}async cleanup(){let e=new Date(Date.now()-864e5*this.config.retentionDays),t=await this.storage.cleanup(e);console.log(`[PerformanceCollector] Cleaned up ${t} old metrics`);let r=new Date(Date.now()-2592e6),s=this.alerts.length;this.alerts=this.alerts.filter(e=>e.timestamp>r);let n=s-this.alerts.length;n>0&&console.log(`[PerformanceCollector] Cleaned up ${n} old alerts`)}updateConfig(e){this.config={...this.config,...e}}getConfig(){return{...this.config}}}let o=new a},73566:e=>{"use strict";e.exports=require("worker_threads")},74075:e=>{"use strict";e.exports=require("zlib")},76760:e=>{"use strict";e.exports=require("node:path")},77598:e=>{"use strict";e.exports=require("node:crypto")},78474:e=>{"use strict";e.exports=require("node:events")},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},80594:()=>{},81630:e=>{"use strict";e.exports=require("http")},81820:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>I,routeModule:()=>x,serverHooks:()=>A,workAsyncStorage:()=>M,workUnitAsyncStorage:()=>S});var s={};r.r(s),r.d(s,{GET:()=>E,POST:()=>k});var n=r(45002),i=r(89587),a=r(1202),o=r(24715),c=r(69535),l=r(34754);class u{constructor(e){this.processingTimes=new Map,this.originalQueue=e,this.wrapQueueMethods()}wrapQueueMethods(){let e=this.originalQueue.enqueue.bind(this.originalQueue);this.originalQueue.enqueue=async t=>{let r=this.originalQueue.getQueueSize();return await c.Y5.recordEventMetric({eventType:"queue_size",processingTime:0,queueSize:r+1,eventSource:"internal",tags:{operation:"enqueue",event_type:t.type}}),e(t)};let t=this.originalQueue.addProcessor.bind(this.originalQueue);this.originalQueue.addProcessor=(e,r)=>{let s=async t=>{let s=performance.now();try{await r(t);let n=performance.now()-s;await c.Y5.recordEventMetric({eventType:t.type,processingTime:n,queueSize:this.originalQueue.getQueueSize(),eventSource:this.getEventSource(t),blockHeight:t.blockHeight,transactionId:t.transactionId,tags:{processor:e,success:"true"}}),this.processingTimes.set(t.type,n)}catch(n){let r=performance.now()-s;throw await c.Y5.recordEventMetric({eventType:t.type,processingTime:r,queueSize:this.originalQueue.getQueueSize(),eventSource:this.getEventSource(t),blockHeight:t.blockHeight,transactionId:t.transactionId,tags:{processor:e,success:"false",error:n instanceof Error?n.message:"unknown"}}),n}};return t(e,s)}}getEventSource(e){return e.transactionId?"flow":e.type.includes("Dapper")?"dapper":"internal"}getAverageProcessingTime(e){return this.processingTimes.get(e)}getAllProcessingTimes(){return new Map(this.processingTimes)}clearProcessingTimes(){this.processingTimes.clear()}}class p{markEventStart(e,t){this.eventStartTimes.set(e,performance.now())}async markEventEnd(e,t){let r=this.eventStartTimes.get(e);if(!r)return null;let s=performance.now()-r;return this.eventStartTimes.delete(e),this.latencyHistory.push({eventType:t,latency:s,timestamp:new Date}),this.latencyHistory.length>1e3&&this.latencyHistory.shift(),await c.Y5.recordEventMetric({eventType:`${t}_latency`,processingTime:s,queueSize:0,eventSource:"internal",tags:{metric_type:"latency",event_id:e}}),s}getLatencyStats(e){let t=this.latencyHistory.filter(t=>t.eventType===e);if(0===t.length)return null;let r=t.map(e=>e.latency).sort((e,t)=>e-t),s=r.length,n=r.reduce((e,t)=>e+t,0),i=r[0],a=r[r.length-1],o=Math.floor(.95*s),c=Math.floor(.99*s),l=r[Math.min(o,s-1)],u=r[Math.min(c,s-1)];return{count:s,average:Math.round(n/s*100)/100,min:i,max:a,p95:l,p99:u}}getRecentLatency(e,t=100){let r=this.latencyHistory;return e&&(r=r.filter(t=>t.eventType===e)),r.sort((e,t)=>t.timestamp.getTime()-e.timestamp.getTime()).slice(0,t)}clearHistory(){this.latencyHistory=[],this.eventStartTimes.clear()}constructor(){this.eventStartTimes=new Map,this.latencyHistory=[]}}class h{subscribeWithPerformanceTracking(e,t,s="unknown"){let n=performance.now();this.subscriptionMetrics.set(s,{subscriptionTime:n,eventCount:0,errorCount:0});let i=null;return(async()=>(await Promise.resolve().then(r.bind(r,26207))).events(e).subscribe({next:async r=>{let n=`${r.transactionId}_${r.eventIndex||0}`,i=this.extractEventType(e);this.latencyMonitor.markEventStart(n,i);let a=this.subscriptionMetrics.get(s);a.eventCount++,a.lastEventTime=performance.now();try{let e={type:i,transactionId:r.transactionId,blockHeight:r.blockHeight,eventIndex:r.eventIndex,data:r.data,timestamp:new Date};await t(e),await this.latencyMonitor.markEventEnd(n,i),await c.Y5.recordEventMetric({eventType:i,processingTime:0,queueSize:0,eventSource:"flow",blockHeight:r.blockHeight,transactionId:r.transactionId,tags:{subscription_type:s,success:"true"}})}catch(e){a.errorCount++,await this.latencyMonitor.markEventEnd(n,i),await c.Y5.recordEventMetric({eventType:i,processingTime:0,queueSize:0,eventSource:"flow",blockHeight:r.blockHeight,transactionId:r.transactionId,tags:{subscription_type:s,success:"false",error:e instanceof Error?e.message:"unknown"}}),console.error(`[PerformanceAwareFlowEventListener] Error processing ${i}:`,e)}},error:async t=>{let r=this.subscriptionMetrics.get(s);r&&r.errorCount++,await c.Y5.recordEventMetric({eventType:"subscription_error",processingTime:0,queueSize:0,eventSource:"flow",tags:{subscription_type:s,event_name:e,error:t instanceof Error?t.message:"unknown"}}),console.error(`[PerformanceAwareFlowEventListener] Subscription error for ${e}:`,t)}}))().then(e=>{i=e}).catch(e=>{console.error("[PerformanceAwareFlowEventListener] Failed to setup subscription:",e)}),()=>{i&&i(),this.subscriptionMetrics.delete(s)}}extractEventType(e){let t=e.split(".");return t[t.length-1]||"unknown"}getSubscriptionMetrics(e){let t=performance.now(),r=new Map;for(let[s,n]of this.subscriptionMetrics.entries()){if(e&&s!==e)continue;let i=t-n.subscriptionTime,a=n.eventCount>0?n.errorCount/n.eventCount*100:0;r.set(s,{...n,uptime:i,errorRate:Math.round(100*a)/100})}return r}getLatencyMonitor(){return this.latencyMonitor}clearMetrics(){this.subscriptionMetrics.clear(),this.latencyMonitor.clearHistory()}constructor(){this.latencyMonitor=new p,this.subscriptionMetrics=new Map}}new u(l.yx);let g=new h,m=new p;var d=r(95847);async function v(e){try{let t=new URL(e.url).searchParams.get("timeRange")||"1h",r=b(t),s=new Date,n=new Date(s.getTime()-r),i=await c.Y5.getMetrics({category:"api",startTime:n,endTime:s,limit:1e3}),a=await c.Y5.getMetrics({category:"event",startTime:n,endTime:s,limit:1e3}),l=await c.Y5.getMetrics({category:"blockchain",startTime:n,endTime:s,limit:1e3}),u=await c.Y5.getAggregatedMetrics("api",{start:n,end:s},"endpoint"),p=await c.Y5.getAggregatedMetrics("event",{start:n,end:s},"eventType"),h=await c.Y5.getAggregatedMetrics("blockchain",{start:n,end:s},"operation"),m=i.length,d=i.length>0?i.reduce((e,t)=>e+t.value,0)/i.length:0,v=i.filter(e=>e.statusCode>=400).length,w=m>0?v/m*100:0,y=a.length,f=a.length>0?a.reduce((e,t)=>e+t.value,0)/a.length:0,T=c.Y5.getActiveAlerts();g.getSubscriptionMetrics();let E={overview:{totalRequests:m,averageResponseTime:Math.round(100*d)/100,errorRate:Math.round(100*w)/100,eventsProcessed:y,averageEventProcessingTime:Math.round(100*f)/100,activeAlerts:T.length},apiMetrics:{endpoints:u.map(e=>({endpoint:e.group,requestCount:e.count,averageResponseTime:e.average,errorRate:0,p95ResponseTime:e.p95,p99ResponseTime:e.p99})),recentRequests:i.slice(0,50).map(e=>e)},eventMetrics:{eventTypes:p.map(e=>({eventType:e.group,processedCount:e.count,averageProcessingTime:e.average,errorRate:0})),recentEvents:a.slice(0,50).map(e=>e),queueStatus:{currentSize:0,averageSize:0,maxSize:0}},blockchainMetrics:{operations:h.map(e=>({operation:e.group,count:e.count,averageTime:e.average,successRate:100})),recentOperations:l.slice(0,50).map(e=>e)},alerts:T,timeRange:{start:n,end:s}};return o.NextResponse.json(E)}catch(e){return console.error("[Performance API] Error fetching dashboard data:",e),o.NextResponse.json({error:"Failed to fetch performance data"},{status:500})}}async function w(e){try{let t=new URL(e.url),r=t.searchParams.get("category"),s=t.searchParams.get("timeRange")||"1h",n=parseInt(t.searchParams.get("limit")||"100"),i=b(s),a=new Date,l=new Date(a.getTime()-i),u=await c.Y5.getMetrics({category:r||void 0,startTime:l,endTime:a,limit:n});return o.NextResponse.json({metrics:u,timeRange:{start:l,end:a},total:u.length})}catch(e){return console.error("[Performance API] Error fetching metrics:",e),o.NextResponse.json({error:"Failed to fetch metrics"},{status:500})}}async function y(e){try{let t=new URL(e.url),r="true"===t.searchParams.get("resolved"),s=c.Y5.getActiveAlerts(),n=r?s:s.filter(e=>!e.resolved);return o.NextResponse.json({alerts:n,total:n.length})}catch(e){return console.error("[Performance API] Error fetching alerts:",e),o.NextResponse.json({error:"Failed to fetch alerts"},{status:500})}}async function f(e){try{let{alertId:t}=await e.json();if(!t)return o.NextResponse.json({error:"Alert ID is required"},{status:400});return c.Y5.resolveAlert(t),o.NextResponse.json({success:!0})}catch(e){return console.error("[Performance API] Error resolving alert:",e),o.NextResponse.json({error:"Failed to resolve alert"},{status:500})}}async function T(e){try{let t=new URL(e.url),r=t.searchParams.get("eventType"),s=parseInt(t.searchParams.get("limit")||"100");if(r){let e=m.getLatencyStats(r),t=m.getRecentLatency(r,s);return o.NextResponse.json({eventType:r,stats:e,recentLatency:t})}{let e=m.getRecentLatency(void 0,s);return o.NextResponse.json({recentLatency:e})}}catch(e){return console.error("[Performance API] Error fetching latency stats:",e),o.NextResponse.json({error:"Failed to fetch latency stats"},{status:500})}}function b(e){let t=e.match(/^(\d+)([smhd])$/);if(!t)return 36e5;let r=parseInt(t[1]);switch(t[2]){case"s":return 1e3*r;case"m":return 6e4*r;case"h":return 36e5*r;case"d":return 864e5*r;default:return 36e5}}let E=(0,d.mF)(async e=>{switch(new URL(e.url).searchParams.get("action")){case"dashboard":default:return v(e);case"metrics":return w(e);case"alerts":return y(e);case"latency":return T(e)}}),k=(0,d.mF)(async e=>"resolve-alert"===new URL(e.url).searchParams.get("action")?f(e):o.NextResponse.json({error:"Invalid action"},{status:400})),x=new n.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/performance/route",pathname:"/api/performance",filename:"route",bundlePath:"app/api/performance/route"},resolvedPagePath:"/home/altcoin-daddy/Downloads/ownly/app/api/performance/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:M,workUnitAsyncStorage:S,serverHooks:A}=x;function I(){return(0,a.patchFetch)({workAsyncStorage:M,workUnitAsyncStorage:S})}},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},95847:(e,t,r)=>{"use strict";r.d(t,{fR:()=>a,gT:()=>i,mF:()=>n});var s=r(69535);function n(e){return async function(t,...r){let n,i;let a=performance.now(),o=new URL(t.url).pathname,c=t.method,l=t.headers.get("content-length")?parseInt(t.headers.get("content-length")):void 0,u=200;try{u=(n=await e(t,...r)).status;let s=n.headers.get("content-length");return s&&(i=parseInt(s)),n}catch(e){throw u=500,e}finally{let e=performance.now()-a;await s.Y5.recordAPIMetric({endpoint:o,method:c,statusCode:u,responseTime:e,requestSize:l,responseSize:i,userAgent:t.headers.get("user-agent")||void 0,ip:t.headers.get("x-forwarded-for")||t.headers.get("x-real-ip")||"unknown",tags:{route:o,status_class:`${Math.floor(u/100)}xx`}})}}}async function i(e,t,r){let n=performance.now();try{let i=await t(),a=performance.now()-n;return await s.Y5.recordAPIMetric({endpoint:`/internal/${e}`,method:"POST",statusCode:200,responseTime:a,tags:{operation:e,...r}}),i}catch(i){let t=performance.now()-n;throw await s.Y5.recordAPIMetric({endpoint:`/internal/${e}`,method:"POST",statusCode:500,responseTime:t,tags:{operation:e,error:i instanceof Error?i.message:"unknown",...r}}),i}}async function a(e,t,r,n){let i=performance.now();try{let a=await n(),o=performance.now()-i;return await s.Y5.recordAPIMetric({endpoint:`${e}${t}`,method:r,statusCode:200,responseTime:o,tags:{external_api:e,api_type:"external"}}),a}catch(o){let n=performance.now()-i,a=500;throw o&&"object"==typeof o&&"status"in o&&(a=o.status||500),await s.Y5.recordAPIMetric({endpoint:`${e}${t}`,method:r,statusCode:a,responseTime:n,tags:{external_api:e,api_type:"external",error:o instanceof Error?o.message:"unknown"}}),o}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[555,912,700,207],()=>r(81820));module.exports=s})();